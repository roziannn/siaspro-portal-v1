generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Event {
  id           Int                @id @default(autoincrement())
  jenis        String
  nama         String
  tanggal      DateTime
  lokasi       String
  kuota        Int
  totalJoin    Int                @default(0)
  status       EventStatus        @default(OPEN)
  createdById  Int
  createdAt    DateTime           @default(now())
  updatedAt    DateTime
  createdBy    User               @relation("CreatedEvents", fields: [createdById], references: [id])
  participants EventParticipant[]

  @@index([createdById])
}

model EventParticipant {
  id       Int      @id @default(autoincrement())
  eventId  Int
  userId   Int
  joinedAt DateTime @default(now())
  event    Event    @relation(fields: [eventId], references: [id])
  user     User     @relation(fields: [userId], references: [id])

  @@unique([eventId, userId])
  @@index([eventId])
  @@index([userId])
}

model JadwalKuliah {
  id         Int     @id @default(autoincrement())
  mataKuliah String
  dosen      String
  ruangan    String
  hari       String
  jamMulai   String
  jamSelesai String
  aktif      Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  createdById Int
  updatedById Int

  createdBy User @relation("UserCreatedJadwal", fields: [createdById], references: [id])
  updatedBy User @relation("UserUpdatedJadwal", fields: [updatedById], references: [id])

  @@index([createdById])
  @@index([updatedById])
}

model Role {
  id       Int        @id @default(autoincrement())
  name     String     @unique
  userRole UserRole[]
}

model User {
  id        Int       @id @default(autoincrement())
  name      String
  email     String    @unique
  password  String
  isActive  Boolean?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  createdEvents  Event[]            @relation("CreatedEvents") // relasi ke createdBy
  joinedEvents   EventParticipant[]
  createdJadwals JadwalKuliah[]     @relation("UserCreatedJadwal")
  updatedJadwals JadwalKuliah[]     @relation("UserUpdatedJadwal")
  userRole       UserRole[]
}

model UserRole {
  id     Int @id @default(autoincrement())
  userId Int
  roleId Int

  role Role @relation(fields: [roleId], references: [id])
  user User @relation(fields: [userId], references: [id])

  @@unique([userId, roleId])
  @@index([roleId])
}

enum EventStatus {
  OPEN
  ONGOING
  CLOSED
}

model DataDosen {
  id           Int      @id @default(autoincrement())
  nip          String   @unique @db.VarChar(255)
  nama         String   @db.VarChar(255)
  email        String   @db.VarChar(255)
  kontak       String   @db.VarChar(255)

  pendidikan   String?  @db.VarChar(100)   // S1, S2, dll
  gelar        String?  @db.VarChar(100)   // M.T., Dr., Prof.
  kampus       String?  @db.VarChar(255)
  jabatan      String?  @db.VarChar(255)
  pangkat      String?  @db.VarChar(255)

  alamat       String?  @db.VarChar(255)   // alamat rumah
  isActive     Boolean  @default(true)     // status aktif atau tidak
  fotoUrl      String?  @db.VarChar(255)   // foto dosen (url)
  tahunMasuk   String?  @db.VarChar(255)   // tahun mulai kerja
  tanggalMasuk DateTime?                      // tanggal mulai kerja

  mahasiswa    DataMahasiswa[]
}


model DataMahasiswa {
  id           Int     @id @default(autoincrement())
  nim          String  @unique @db.VarChar(255)
  nama         String  @db.VarChar(255)
  angkatan     String  @db.VarChar(255)
  jurusan      String  @db.VarChar(255)
  email        String  @db.VarChar(255)
  isActive     Boolean
  fotoUrl      String? @db.VarChar(255)
  fakultas     String? @db.VarChar(255)
  konsentrasi  String? @db.VarChar(255)
  agama        String? @db.VarChar(255)
  alamat       String? @db.VarChar(255)
  telp         String? @db.VarChar(255)
  asalSekolah  String? @db.VarChar(255)
  jalurMasuk   String? @db.VarChar(255)
  tahunMasuk   String? @db.VarChar(255)
  tanggalMasuk DateTime? @db.DateTime(0)
  
  dosenWaliId  Int? 

  dosenWali    DataDosen? @relation(fields: [dosenWaliId], references: [id], map: "fk_dosenwali")

  @@index([dosenWaliId], map: "fk_dosenwali")
}

model Ruangan {
  id         Int      @id @default(autoincrement())
  nama       String
  kapasitas  Int
  lokasi     String
  status     String   // misalnya "tersedia" atau "tidak tersedia"
  fasilitas  Json // array fasilitas, contoh: ["AC", "Proyektor", "Papan Tulis"]
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}
