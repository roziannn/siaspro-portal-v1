generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Event {
  id           Int                @id @default(autoincrement())
  jenis        String
  nama         String
  tanggal      DateTime
  lokasi       String
  kuota        Int
  totalJoin    Int                @default(0)
  status       EventStatus        @default(OPEN)
  createdById  Int
  createdAt    DateTime           @default(now())
  updatedAt    DateTime
  createdBy    User               @relation("CreatedEvents", fields: [createdById], references: [id])
  participants EventParticipant[]

  @@index([createdById])
}

model EventParticipant {
  id       Int      @id @default(autoincrement())
  eventId  Int
  userId   Int
  joinedAt DateTime @default(now())
  event    Event    @relation(fields: [eventId], references: [id])
  user     User     @relation(fields: [userId], references: [id])

  @@unique([eventId, userId])
  @@index([eventId])
  @@index([userId])
}

model JadwalKuliah {
  id         Int     @id @default(autoincrement())
  mataKuliah String
  dosen      String
  ruangan    String
  hari       String
  jamMulai   String
  jamSelesai String
  aktif      Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  createdById Int
  updatedById Int

  createdBy User @relation("UserCreatedJadwal", fields: [createdById], references: [id])
  updatedBy User @relation("UserUpdatedJadwal", fields: [updatedById], references: [id])

  @@index([createdById])
  @@index([updatedById])
}

model Role {
  id       Int        @id @default(autoincrement())
  name     String     @unique
  userRole UserRole[]
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  name      String?
  isActive  Boolean?
  createdAt DateTime @default(now())

  createdEvents  Event[]            @relation("CreatedEvents") // relasi ke createdBy
  joinedEvents   EventParticipant[]
  createdJadwals JadwalKuliah[]     @relation("UserCreatedJadwal")
  updatedJadwals JadwalKuliah[]     @relation("UserUpdatedJadwal")
  userRole       UserRole[]
}

model UserRole {
  id     Int @id @default(autoincrement())
  userId Int
  roleId Int

  role Role @relation(fields: [roleId], references: [id])
  user User @relation(fields: [userId], references: [id])

  @@unique([userId, roleId])
  @@index([roleId])
}

enum EventStatus {
  OPEN
  ONGOING
  CLOSED
}
